
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Scott W. Bradley</title>
  <meta name="author" content="Scott W. Bradley">

  
  <meta name="description" content="Introducing the &#8220;Picante Paloma&#8221;. It&#8217;s a sweet, spicy, and refreshing drink that&#8217;s perfect for the first day of summer. This &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://scottwb.com/blog/page/2">

  
  <link href="/favicon.png" rel="icon">

  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Scott W. Bradley" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28351625-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Scott W. Bradley</a></h1>
  
    <h2>in which scottwb thinks out loud</h2>
  
  <a href="https://github.com/scottwb"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:scottwb.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/profile">Profile</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/21/spicy-summer-drink/">Spicy Summer Drink</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-21T20:08:00-07:00" pubdate data-updated="true">Jun 21<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/06/21/spicy-summer-drink/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Introducing the &#8220;Picante Paloma&#8221;. It&#8217;s a sweet, spicy, and refreshing drink that&#8217;s perfect for the first day of summer. This is a mix of a recipe my wife and I found on the internet, a drink we tasted at a friend&#8217;s wedding called &#8220;Late For Work&#8221;, and our own experimentation. It&#8217;s more-or-less paleo-friendly, depending on how picky you are about the ingredients.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/21/spicy-summer-drink/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/23/using-newrelic-with-custom-ruby-worker-daemons/">Using NewRelic With Custom Ruby Worker Daemons</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-23T07:48:00-07:00" pubdate data-updated="true">May 23<span>rd</span>, 2013</time>
        
         | <a href="/blog/2013/05/23/using-newrelic-with-custom-ruby-worker-daemons/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The NewRelic Ruby Agent comes with great support for Rails, Sinatra, and other frameworks and web servers out of the box. It also supports background jobs for frameworks like DelayedJob and Resque.</p>

<p>But what if you have your own custom background worker mechanism?</p>

<p>It&#8217;s fairly simple to get NewRelic working to report your custom background workers, but finding the right combination of setup calls in their docs can be a little tricky. The biggest issue is dealing with background tasks that daemonize and fork child worker processes. This is because the NewRelic agent needs to do unique instrumenting, monitoring, and reporting per process. Setting it up that way can be tricky if you&#8217;re using Bundler or another mechanism to load the <code>newrelic_rpm</code> gem <em>before</em> the child processes are forked.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/05/23/using-newrelic-with-custom-ruby-worker-daemons/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/06/always-on-https-with-rails-behind-an-elb/">Always-On HTTPS With Rails Behind an ELB</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-06T11:43:00-08:00" pubdate data-updated="true">Feb 6<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/06/always-on-https-with-rails-behind-an-elb/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So you want to run your Rails site such that it always uses HTTPS, and you want all HTTP URLs to redirect to their HTTPS counterparts? Typically you use <code>config.force_ssl = true</code> in your initializer, or you use <code>force_ssl</code> in your controllers. For various reasons having to do with late-binding configuration, I have typically not been able to use the <code>config.force_ssl</code> method. This means the easiest way to force the whole site to use HTTPS has been to use <code>force_ssl</code> on the base <code>ApplicationController</code>, like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/controllers/application_controller.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">force_ssl</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>However&#8230;when you deploy this to Amazon EC2 behind an ELB (Elastic Load Balancer), you can run into problems.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/02/06/always-on-https-with-rails-behind-an-elb/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/06/hsts-on-rails/">HSTS on Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-06T09:47:00-08:00" pubdate data-updated="true">Feb 6<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/06/hsts-on-rails/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HTTP Strict Transport Security</a> (HSTS) is a recent specification aimed at stopping a certain type of man-in-the-middle attack known as <em>SSL Stripping</em>. By default, when a user types &#8220;example.com&#8221; into their browser, the browser prefixes that with &#8220;http://&#8221;. A man-in-the-middle attack can hijack the connection before the server redirect to HTTPS gets back to the browser, spoofing the site and potentially luring the user into providing sensitive data to the attacker.</p>

<p>You can read a nice explanation of this attack, and how HSTS helps to prevent it <a href="http://www.imperialviolet.org/2012/07/19/hope9talk.html">here</a>.</p>

<p>The <a href="http://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">wikipedia page on HSTS</a> provides some examples on how to enable this in your web server (apache, nginx, etc). However, when running behind an ELB in Amazon Web Services, where you cannot configure this at the reverse proxy, you may wish to do this in your application.</p>

<p>Here is how to achieve that in Ruby on Rails, using a <code>before_filter</code> in your base <code>ApplicationController</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">before_filter</span> <span class="ss">:strict_transport_security</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">strict_transport_security</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">ssl?</span>
</span><span class='line'>      <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Strict-Transport-Security&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;max-age=31536000; includeSubDomains&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/21/cohort-analysis/">Cohort Analysis</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-21T13:58:00-08:00" pubdate data-updated="true">Jan 21<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/01/21/cohort-analysis/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After a few conversations with a former colleauge about statistics, metrics, and analytics, I thought I&#8217;d dig up some good articles to summarize some of the key Lean Startup principles surrounding metrics and data-driven decision-making for those who haven&#8217;t had the pleasure of reading Eric Reis&#8217;s book <em>Lean Startup</em>. That turned into a blog post about what metrics we report as developers and ops guys, and why we need to focus on <em>Actionable Metrics</em> over <em>Vanity Metrics</em>.</p>

<p> My goal is to provide a little background on <em>Actionable Metrics</em> and how they differ from <em>Vanity Metrics</em>. Understanding this is a central theme of the book <em>Lean Startup</em>, by Eric Reis, and the writings and teachings of a number of other prominent startup/entrepreneur/lean proponents such as Steve Blank, Dave McClure, and Ash Maurya. Fred Wilson of Union Square Ventures, has been quoted saying, &#8220;one of our firm&#8217;s favorite measurements is the cohort analysis&#8221;.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/01/21/cohort-analysis/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/13/provision-and-bootstrap-windows-ec2-instances-with-chef/">Provision and Bootstrap Windows EC2 Instances With Chef</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-13T05:17:00-08:00" pubdate data-updated="true">Dec 13<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/12/13/provision-and-bootstrap-windows-ec2-instances-with-chef/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post illustrates how you can have a single script on your workstation (yes, of course, it&#8217;s a Mac) that provisions a new Windows EC2 instance and bootstraps it using Opscode Chef &#8211; written from the point of view of someone who is used to doing this all the time with ease for Linux instances using the <code>knife-ec2</code> gem. I&#8217;ll assume the reader:</p>

<ul>
<li>has a basic working knowledge of Opscode Chef</li>
<li>is using Hosted Chef</li>
<li>already has a working chef-repo workstation with <code>knife</code> configured</li>
<li>already has (or can figure out) <code>knife-ec2</code> installed and configured with AWS API credentials</li>
<li>is on their own for creating actual cookbooks and roles to configure their Windows instances</li>
</ul>


<p>This is fairly easy to do with Linux instances. Using <code>knife ec2 server create</code> and a bunch of parameters, a single command provisions a new Linux instance in EC2, waits for it to come up, connects to it over SSH using the specified key pair, installs <code>chef-client</code>, and bootstraps the node using the specified run_list. Done.</p>

<p>However, things are not so simple for Windows Server instances.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/12/13/provision-and-bootstrap-windows-ec2-instances-with-chef/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/15/the-joys-of-working-from-home/">The Joys of Working From Home</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-15T17:21:00-07:00" pubdate data-updated="true">Aug 15<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/15/the-joys-of-working-from-home/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.flickr.com/photos/scottwb69/sets/72157630674264242/detail/"><img class="left" src="http://farm9.staticflickr.com/8022/7612882390_880e5abdc8.jpg"></a></p>

<p>I work in a team that is distributed around the country, where everyone works from their home offices. Sounds great, doesn&#8217;t it? Well, it&#8217;s not for everyone. First, you have to be seriously self-motivated. Personally, I get more done at home than I ever have at an office, because I get to choose when to be distracted and <em>I&#8217;m good at staying focused</em>. For some people, choosing when to be distracted is a curse. They choose to be distracted all the time. Facebook, twitter, bathroom, kitchen, twitter, kids, etc.</p>

<p>Still, some of those home distractions can plague even the most focused of us. One of the keys I&#8217;ve found to succesfully working from home is to have a dedicated work space. I am lucky enough to have an extra room to use as an office, and the family knows that when I&#8217;m in there, &#8220;Daddy&#8217;s at work&#8221;.</p>

<p>But sometimes that&#8217;s not enough&#8230;</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/08/15/the-joys-of-working-from-home/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/14/merge-git-repositories-and-preseve-commit-history/">Merge Git Repositories and Preseve Commit History</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-14T11:42:00-07:00" pubdate data-updated="true">Jul 14<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/14/merge-git-repositories-and-preseve-commit-history/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Every time I want to combine two git repositories into a new high-level repository, I have to re-figure it out. I decided this time to write it down. Maybe someone else will find this useful too.</p>

<p>Here is my scenario: I have two repositories. I want to make a new empty repository and move the other two into it as subdirectories. I also want to preserve all the commit history of the original repositories.</p>

<p>Here are the steps involved for the first repository:</p>

<ol>
<li>Clone the first source repository</li>
<li>Remove its origin ref so you dont&#8217; accidentally push any screwups</li>
<li>Make a subdir in that source repo named the same as the repo</li>
<li>Move all the top-level files into that directory</li>
<li>Commit that move.</li>
<li>Create (or clone) your desination repository.</li>
<li>Add a remote ref to it that points to the file location of your source repo clone.</li>
<li>Pull from that ref</li>
<li>Remove that remote ref.</li>
</ol>


<p>You can now delete the clone of the source repository you, so you don&#8217;t really keep those file moves around in the original source if you don&#8217;t want to.</p>

<p>Here&#8217;s what those steps might look like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Step 1</span>
</span><span class='line'><span class="nv">$ </span>git clone SOURCE_REPO_URL
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>source_repo_name
</span><span class='line'>
</span><span class='line'><span class="c"># Step 2</span>
</span><span class='line'><span class="nv">$ </span>git remote rm origin
</span><span class='line'>
</span><span class='line'><span class="c"># Step 3</span>
</span><span class='line'><span class="nv">$ </span>mkdir source_repo_name
</span><span class='line'>
</span><span class='line'><span class="c"># Step 4</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># NOTE: You can&#39;t actually do this command verbatim. You need to</span>
</span><span class='line'><span class="c">#       git mv each top-level file/dir individually and don&#39;t forget</span>
</span><span class='line'><span class="c">#       .* files like .gitignore, but DO NOT copy the .git directory.</span>
</span><span class='line'><span class="nv">$ </span>git mv * source_repo_name/.
</span><span class='line'>
</span><span class='line'><span class="c"># Step 5</span>
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s2">&quot;Prepare source_repo_name to merge into dest_repo_name&quot;</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ..
</span><span class='line'>
</span><span class='line'><span class="c"># Step 6</span>
</span><span class='line'><span class="nv">$ </span>git clone DST_REPO_URL
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>dest_repo_name
</span><span class='line'>
</span><span class='line'><span class="c"># Step 7</span>
</span><span class='line'><span class="nv">$ </span>git remote add source_repo_name SRC_REPO_FILEPATH
</span><span class='line'>
</span><span class='line'><span class="c"># Step 8</span>
</span><span class='line'><span class="nv">$ </span>git pull source_repo_name master
</span><span class='line'>
</span><span class='line'><span class="c"># Step 9</span>
</span><span class='line'><span class="nv">$ </span>git remote rm source_repo_name
</span></code></pre></td></tr></table></div></figure>


<p>Now you&#8217;re done and can delete the source repository clone, and push the destination repository clone upstream. Check the <code>git log</code> to be sure.</p>

<h3>A Concrete Example</h3>

<p>Say I have two repositories on github named <code>homer</code> and <code>bart</code> and I want to combine them into a new repository called <code>simpsons</code>. Here is how that looks:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># ...First create a new empty repository on github named &#39;simpsons&#39;...</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Clone all the repos to work with</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ~/src
</span><span class='line'><span class="nv">$ </span>git clone git@github.com:scottwb/homer.git
</span><span class='line'><span class="nv">$ </span>git clone git@github.com:scottwb/bart.git
</span><span class='line'><span class="nv">$ </span>git clone git@github.com:scottwb/simpsons.git
</span><span class='line'>
</span><span class='line'><span class="c"># Copy over homer to simpsons</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>homer
</span><span class='line'><span class="nv">$ </span>git remote rm origin
</span><span class='line'><span class="nv">$ </span>mkdir homer
</span><span class='line'><span class="nv">$ </span>git mv *.* homer/.
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s2">&quot;Prepare homer to merge into simpsons&quot;</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ../simpsons
</span><span class='line'><span class="nv">$ </span>git remote add homer ~/src/homer
</span><span class='line'><span class="nv">$ </span>git pull homer master
</span><span class='line'><span class="nv">$ </span>git remote rm homer
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ..
</span><span class='line'><span class="nv">$ </span>rm -rf homer
</span><span class='line'>
</span><span class='line'><span class="c"># Copy over bart to simpsons</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>bart
</span><span class='line'><span class="nv">$ </span>git remote rm origin
</span><span class='line'><span class="nv">$ </span>mkdir bart
</span><span class='line'><span class="nv">$ </span>git mv *.* bart/.
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s2">&quot;Prepare bart to merge into simpsons&quot;</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ../simpsons
</span><span class='line'><span class="nv">$ </span>git remote add bart ~/src/bart
</span><span class='line'><span class="nv">$ </span>git pull bart master
</span><span class='line'><span class="nv">$ </span>git remote rm bart
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ..
</span><span class='line'><span class="nv">$ </span>rm -rf bart
</span><span class='line'>
</span><span class='line'><span class="c"># Push simpsons back upstream to github</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>simpsons
</span><span class='line'><span class="nv">$ </span>git push
</span></code></pre></td></tr></table></div></figure>


<h3>Bonus Points: Only Moving a Sub-Directory</h3>

<p>What if you only want to move a subdirectory of the original source repository into the destination repository? All you need to do is filter out what you copy into that new sub-directory you create in step 4, and make sure everything else gets removed from that source repository. (Don&#8217;t worry - remember, you&#8217;re just working with a local working copy of that source repo, that you&#8217;re going top discard after this operation. You won&#8217;t harm anything irreversibly here.)</p>

<p>One way to peform that filtering is by using the <code>git filter-branch</code> command. For example, to only copy the <code>pranks</code> subdir from the <code>bart</code> repo, just before step 4, you would do something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git filter-branch --subdirectory-filter pranks -- --all
</span></code></pre></td></tr></table></div></figure>


<p>That dumps all the contents of the <code>pranks</code> dir into top-level dir where you can proceed to move them into your new subdir that you created in step 3.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/12/customize-attribute-accessors-on-ripple-models/">Customize Attribute Accessors on Ripple Models</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-12T09:18:00-07:00" pubdate data-updated="true">Jul 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/12/customize-attribute-accessors-on-ripple-models/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sometimes in your Ruby on Rails models, you want to override the attribute accessors to do additional processing on the values on their way in and out of the data storage layer. Custom serialization is a common use of this.</p>

<p>For example, when using ActiveRecord for your Rails models, you can provide custom attribute accessors, say to serialize a Hash to JSON, using the <code>read_attribute</code> and <code>write_attribute</code> methods like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Assume a text column named &#39;stuff&#39;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">stuff</span>
</span><span class='line'>    <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">read_attribute</span><span class="p">(</span><span class="ss">:stuff</span><span class="p">))</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">stuff</span><span class="o">=</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>
</span><span class='line'>    <span class="n">write_attribute</span><span class="p">(</span><span class="ss">:stuff</span><span class="p">,</span> <span class="n">new_val</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this, you can assign a Hash to the <code>stuff</code> attribute of <code>User</code>, and when you access it via <code>User#stuff</code>, you get a Hash back. All the while, it&#8217;s read and written to and from the database as a JSON string.</p>

<h3>Doing it with Ripple on top of Riak</h3>

<p><a href="https://github.com/seancribbs/ripple/">Ripple</a> is the Ruby modeling layer for the distributed NoSQL store, <a href="http://basho.com/products/riak-overview/">Riak</a>. It tries very hard to provide a lot of the same interfaces as ActiveRecord. However, this is one of the areas it diverges: <code>Ripple::Document</code> objects do not support the <code>read_attribute</code> and <code>write_attribute</code> methods.</p>

<p>Instead, they implement the <code>[]</code> and <code>[]=</code> methods. Translating the code above to work with Ripple is pretty easy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Ripple</span><span class="o">::</span><span class="no">Document</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">property</span> <span class="ss">:stuff</span><span class="p">,</span> <span class="no">Hash</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">stuff</span>
</span><span class='line'>    <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">self</span><span class="o">[</span><span class="ss">:stuff</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">stuff</span><span class="o">=</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">[</span><span class="ss">:stuff</span><span class="o">]</span> <span class="o">=</span> <span class="n">new_val</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Bonus Points</h3>

<p>Using this tactic, you can easily add some memoization so that your getter doesn&#8217;t need to parse the JSON text on every access. To do this, we&#8217;ll use an instance variable as a cache that we&#8217;ll invalidate in the setter, like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Ripple</span><span class="o">::</span><span class="no">Document</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">property</span> <span class="ss">:stuff</span><span class="p">,</span> <span class="no">Hash</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">stuff</span>
</span><span class='line'>    <span class="vi">@cached_stuff</span> <span class="o">||=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">self</span><span class="o">[</span><span class="ss">:stuff</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">stuff</span><span class="o">=</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@cached_stuff</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">[</span><span class="ss">:stuff</span><span class="o">]</span> <span class="o">=</span> <span class="n">new_val</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/30/show-jquery-mobile-page-loading-with-text-and-spinner/">Show jQuery Mobile Page Loading With Text and Spinner</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-30T21:47:00-07:00" pubdate data-updated="true">Jun 30<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/30/show-jquery-mobile-page-loading-with-text-and-spinner/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I like jQuery Mobile&#8217;s page loading spinner. When you transition between pages it displays a nice subtle spinner while the page loads, only if the page load takes more than a configured number of milliseconds.</p>

<p>So, I wanted to use their page-loading spinner for in-page wait times in my app. The user clicks something, I do some AJAX stuff and show them a nice spinner with a message telling them what&#8217;s going on until the results come back. jQuery Mobile has javascript functions for this called <code>$.mobile.showPageLoadingMsg</code> and <code>$.hidePageLoadingMsg</code>. The problem is, you can either show a spinner only, or a text-message only. You can&#8217;t show both a spinner <em>and</em> a text message, even though they clearly support it. Well, you <em>can</em> do that if you have the global setting <code>$.mobile.loadingMessageTextVisible = true</code>, but then you get a text with your normal page-load spinners.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/06/30/show-jquery-mobile-page-loading-with-text-and-spinner/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section class='aboutMe'>
  <h1>About Me</h1>
  <img class="left" src="/favicon.png" width="75" height="75">
  <p>Husband. Father. Techie. Founder and Principal Engineer at <a href="http://facetdigital.com/">Facet Digital, LLC</a>. Fitness and health enthusiast. Seattle Sounders FC fan. All opinions are mine alone. All trademarks are property of their respective owners.</p>
</section>
<section>
  <h1>Latest Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/28/if-i-were-22/">If I Were 22</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/27/8-startup-lessons-in-6-months/">8 Startup Lessons in 6 Months</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/09/wake-surfing-with-rubymotion/">Wake Surfing With RubyMotion</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/24/defeating-the-infamous-chef-3694-warning/">Defeating The Infamous CHEF-3694 Warning</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/11/optimistic-locking-with-couchbase-and-ruby/">Optimistic Locking With Couchbase and Ruby</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("scottwb69", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/scottwb69" class="twitter-follow-button" data-show-count="true">Follow @scottwb69</a>
  
</section>


<section>
  <h1>Latest Code</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/scottwb">@scottwb</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        var blacklist = [];
        
          
            blacklist.push('scottwb.github.com');
          
            blacklist.push('haml-block-bug');
          
        

        github.showRepos({
            user: 'scottwb',
            count: 5,
            skip_forks: true,
            blacklist: blacklist,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/106700002337561490782?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section class='shelfari'>
  <h1>Latest Books</h1>
  <div id="ShelfariWidget203753"><a href='http://www.shelfari.com/'>Shelfari: Book reviews on your book blog</a><script src="http://www.shelfari.com/ws/203753/widget.js?r=41860" type="text/javascript" language="javascript"></script></div>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Scott W. Bradley -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'scottwb';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
