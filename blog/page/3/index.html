
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Scott W. Bradley</title>
  <meta name="author" content="Scott W. Bradley">

  
  <meta name="description" content="I am pleased to announce that I have found my new home. As of next week, I&#8217;ll be starting my new position as the VP of Engineering at Validas. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://scottwb.com/blog/page/3">

  
  <link href="/favicon.png" rel="icon">

  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Scott W. Bradley" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28351625-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Scott W. Bradley</a></h1>
  
    <h2>in which scottwb thinks out loud</h2>
  
  <a href="http://github.com/scottwb"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/camo.github.com/abad93f42020b733148435e2cd92ce15c542d320/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub"></a>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:scottwb.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/profile">Profile</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/27/my-new-home/">My New Home</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-27T13:00:00-07:00" pubdate data-updated="true">Apr 27<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/04/27/my-new-home/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I am pleased to announce that I have found my new home. As of next week, I&#8217;ll be starting my new position as the VP of Engineering at <a href="http://www.validas.com/">Validas</a>.</p>

<p><a href="http://www.validas.com/"><img class="left" src="/images/validas-logo.png" title="Validas" alt="Validas"></a></p>

<p>Over the last two months, I&#8217;ve networked with a lot of great people and have considered opportunties at many great companies. There are so many exciting things going on in our industry, that this was not an easy decision. After taking some time to reflect, the opportunity at Validas stood out above the rest for a number of reasons.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/04/27/my-new-home/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/19/custom-error-handling-with-express-resource-auto-loading/">Custom Error Handling With Express Resource Auto-Loading</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-19T14:05:00-07:00" pubdate data-updated="true">Apr 19<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/04/19/custom-error-handling-with-express-resource-auto-loading/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><span class='pullquote-right' data-pullquote='You get no control over how the errors are handled, and the default mechanism is ignorant of the requested format.'>
<a href="https://github.com/visionmedia/express-resource">Express Resource</a> adds RESTful resource routing on top of the <a href="http://expressjs.com/">Express</a> framework for <a href="http://nodejs.org/">Node.js</a>. It includes a nice feature called &#8220;Auto-Loading&#8221; that allows you to define a single <code>load</code> method that will automatically be used to load your resource object from a URL id parameter and set it in the request object to be accessed by your conventional RESTful methods that need it. Another great feature of Express Resource is what they call &#8220;Content-Negotiation&#8221;. URLs with format extensions like <code>.xml</code> or <code>.json</code> automatically set an indicator of the format in the request so your actions can respond accordingly.</p>

<p>However, a problem arises when you use the recommended method for handling and reporting errors from within your <code>load</code> method: You get no control over how the errors are handled, and the default mechanism is ignorant of the requested format. This makes it tough to return nice JSON errors, for example, from a REST API that uses this technique.
</span></p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/04/19/custom-error-handling-with-express-resource-auto-loading/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/06/moving-on/">Moving On</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-06T12:25:00-08:00" pubdate data-updated="true">Mar 6<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/06/moving-on/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Last week I resigned my position as CTO at <a href="http://www.balassanianenterprises.com/">Balassanian Enterprises</a>.</p>

<p>Those of you who know me know that this is <em>huge</em>. I&#8217;ve been working closely with the founder, Edward Balassanian, for a <em>long</em> time. It&#8217;s been spread over multiple companies and an array of varying products, but it&#8217;s always been a shared ethos with the same core group of people that has defined that period of my career. Leaving that behind feels a bit like an emotional breakup. Such a big part of my professional and personal identity was wrapped up in how we worked together, what we built, where we&#8217;ve been, and our vision of the future. We put everything into it.</p>

<p>It&#8217;s also a bit like leaving home to explore new worlds.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/06/moving-on/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/24/middleman-deployment-rakefile/">Middleman Deployment Rakefile</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-24T09:30:00-08:00" pubdate data-updated="true">Feb 24<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/02/24/middleman-deployment-rakefile/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I started tinkering with <a href="http://middlemanapp.com/">Middleman</a> the other day to build a small static website.</p>

<p>In the past, I&#8217;ve used <a href="http://staticmatic.rubyforge.org/">StaticMatic</a>, <a href="http://jekyllrb.com/">Jekyll</a>, or <a href="http://octopress.org/">Octopress</a> for this sort of thing. Jekyll and Octopress are great for blogs. StaticMatic is great for prototyping a static site with Haml and Sass that you can easily migrate to your Rails app.</p>

<p><span class='pullquote-right' data-pullquote='any custom middleware you add to the stack gets invoked for all the pages it generates.'>
I&#8217;ve been using Middleman for less than 24 hours at this point, but so far it seems great. One of the things I like about it is that it&#8217;s actually serving your site dynamically with Sinatra, and comes out of the box with Haml, Sass, Compass, view helpers, lorem ipsum generators, CSS and Javascript minification, and more. Plus, you can throw in any other Rack middleware you like, for example, the Google Analytics middleware. While you&#8217;re developing the site, you run the preview server and your changes are immediately visible without restarting it. The cool part is that when you deploy, it actually generates all the static pages by executing the Rack server and running requests through it. This means any custom middleware you add to the stack gets invoked for all the pages it generates.
</span></p>

<p>Middleman imposes very little structure. This is refreshing if you&#8217;re just making a one- or two-page site. It lets you get started right away and build whatever organization you want for yourself. It doesn&#8217;t tell you how to deploy your site. That&#8217;s I&#8217;m here to do. :)</p>

<p>I took a little inspiration from Octopress&#8217;s Rakefile and put together a simple Rakefile for use with Middleman that helps you deploy your static site via rsync. It also adds a few little wrapper tasks for things like remembering to add the <code>--clean</code> flag, and an Octopress-like <code>rake gen_deploy</code> task that regenerates and deploys in one step.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rake -T
</span><span class='line'>rake build       <span class="c"># Build the website from source</span>
</span><span class='line'>rake deploy      <span class="c"># Deploy website via rsync</span>
</span><span class='line'>rake gen_deploy  <span class="c"># Build and deploy website</span>
</span><span class='line'>rake preview     <span class="c"># Run the preview server at http://localhost:4567</span>
</span></code></pre></td></tr></table></div></figure>


<p>Simply drop this Rakefile into the root of your Middleman project and edit the SSH variables at the top.</p>

<figure class='code'><figcaption><span>Rakefile </span><a href='https://gist.github.com/1902178'>View Gist</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">SSH_USER</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span>
</span><span class='line'><span class="no">SSH_HOST</span> <span class="o">=</span> <span class="s1">&#39;www.example.com&#39;</span>
</span><span class='line'><span class="no">SSH_DIR</span>  <span class="o">=</span> <span class="s1">&#39;/var/www/html/www.example.com&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Build the website from source&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;## Building website&quot;</span>
</span><span class='line'>  <span class="n">status</span> <span class="o">=</span> <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;middleman build --clean&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">status</span> <span class="p">?</span> <span class="s2">&quot;OK&quot;</span> <span class="p">:</span> <span class="s2">&quot;FAILED&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Run the preview server at http://localhost:4567&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:preview</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;middleman server&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Deploy website via rsync&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:deploy</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;## Deploying website via rsync to </span><span class="si">#{</span><span class="no">SSH_HOST</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="n">status</span> <span class="o">=</span> <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;rsync -avze &#39;ssh&#39; --delete build/ </span><span class="si">#{</span><span class="no">SSH_USER</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="no">SSH_HOST</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">SSH_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">status</span> <span class="p">?</span> <span class="s2">&quot;OK&quot;</span> <span class="p">:</span> <span class="s2">&quot;FAILED&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Build and deploy website&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:gen_deploy</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:build</span><span class="p">,</span> <span class="ss">:deploy</span><span class="o">]</span> <span class="k">do</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/23/a-better-way-to-add-mobile-pages-to-a-rails-site/">A Better Way to Add Mobile Pages to a Rails Site</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-23T10:42:00-08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2012</time>
        
         | <a href="/blog/2012/02/23/a-better-way-to-add-mobile-pages-to-a-rails-site/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Having a mobile version of your website is a pretty common thing these days. Doing it with Ruby on Rails seems pretty common as well. Yet there seems to be a lot of misguidance on the web when you search google for advice on making mobile sites in Rails. There are two prevailing suggestions for accomplishing this that I think are undesirable. I&#8217;ve come up with another variation on this that I think is more maintainable and better for the end user.</p>

<p>But first&#8230;some background&#8230;</p>

<p><em><strong>TL;DR:</strong> Don&#8217;t use custom MIME formats or domain redirects. Use custom view paths. Skip to &#8220;The Final Solution&#8221; at the bottom, if you don&#8217;t care why.</em></p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/02/23/a-better-way-to-add-mobile-pages-to-a-rails-site/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/22/html5-placeholder-polyfill-with-jquery-mobile/">HTML5 Placeholder Polyfill With jQuery Mobile</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-22T11:29:00-08:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2012</time>
        
         | <a href="/blog/2012/02/22/html5-placeholder-polyfill-with-jquery-mobile/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>IE9 doesn&#8217;t support the <code>placeholder</code> attribute on <code>input</code> elements. Why does this matter for a jQuery Mobile site? If you want to build a single mobile-first page with jQuery Mobile, and use resposive design techiniques to display the same page on desktop browsers, you might appreciate the ability to use the HTML5 <code>placeholder</code> in your design, and still need to support at least IE9.</p>

<p>Using a <code>placeholder</code> on an input field is a nice way to save space on a mobile form. It lets you forgo the field labels while still telling the user what the fields are for. In many cases its utility goes beyond labeling; you might need it to express input requirements such as what unit of measurement to use in a &#8220;distance&#8221; field. This is just as useful in a desktop design as it is in a mobile design.</p>

<p>There is a growing movement of creating polyfills for this sort of thing - especially targeted at Internet Explorer. If you&#8217;re not already using something like <a href="http://www.modernizr.com/">Modernizr</a> to fulfill all your HTML5 polyfill needs, and just want a solution for the <code>placeholder</code> attribute, you&#8217;re in luck. The Modernizr wiki has a <a href="https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-browser-Polyfills">list of polyfills</a>. You&#8217;ll see that there are quite a few placeholder polyfills&#8230;but they are not all created equal.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/02/22/html5-placeholder-polyfill-with-jquery-mobile/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/17/jquery-mobile-and-rails-ujs-method-links/">jQuery Mobile and Rails UJS Method Links</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-17T19:59:00-08:00" pubdate data-updated="true">Feb 17<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/02/17/jquery-mobile-and-rails-ujs-method-links/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Rails UJS and jQuery Mobile do not play nice together when it comes to combining Rails UJS&#8217;s handling of non-GET/POST links with jQuery Mobile&#8217;s data attributes such as <code>data-ajax</code>, <code>data-direction</code>, and <code>data-transition</code>. This post demonstrates a quick hack you can use to remedy this.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/02/17/jquery-mobile-and-rails-ujs-method-links/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/17/auto-focus-the-first-form-element-with-jquery-mobile/">Auto-Focus the First Form Element With jQuery Mobile</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-17T10:08:00-08:00" pubdate data-updated="true">Feb 17<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/02/17/auto-focus-the-first-form-element-with-jquery-mobile/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Imagine a series of pages with simple forms on each of them. With jQuery Mobile, you&#8217;ll usually end up transitioning between these pages using AJAX and nice slide transitions. Since all your forms will end up in the same document, you need to be careful to give them unique IDs if you want to access them from javascript.</p>

<p>One thing I like to do with forms, especially on mobile platforms, is to automatically highlight the first field in the form when it comes in to view. The trick with jQuery Mobile is that with AJAX loading, pre-loading, and BACK/FORWARD buttons, you need to figure out which form is currently in view, and when transitions between forms happen.</p>

<p>Fortunately jQuery Mobile provides us the two facilities we need:</p>

<ul>
<li>The <code>ui-page-active</code> CSS class gets applied to the <code>.page</code> element that is currently in view.</li>
<li>The <code>pageshow</code> event gets triggered on the document when a page transition has completed to change which page is in view.</li>
</ul>


<p>Combine these two, and you can do something like this in your main javascript once for the whole document:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;pageshow&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.page.ui-page-active form :input:visible&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">focus</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, after every page transition, if there is a form on the newly-visible page, the first visible input element automatically receives focus. This works across AJAX, non-AJAX, and BACK/FORWARD page transitions.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/16/revisited-adding-filters-to-stock-devise-controllers/">Revisited: Adding Filters to Stock Devise Controllers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-16T23:54:00-08:00" pubdate data-updated="true">Feb 16<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/02/16/revisited-adding-filters-to-stock-devise-controllers/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Six months ago, I wrote a quick blog post about <a href="http://sleeplesscoding.blogspot.com/2011/08/adding-filters-to-stock-device.html">adding custom filters to stock Devise controllers</a> without subclassing all the Devise controllers. At the end of the post I noted that the prescribed method only worked in the production environment, and not in development.</p>

<p>Today I come to you with a solution that works in development as well as production. The basic mechanics are the same, but we&#8217;ll factor it slightly differently.</p>

<p>First, we&#8217;ll create a module in <code>config/initializers/devise_filters.rb</code> where we&#8217;ll implement a method to add all the filters to Devise that we want. We also need to make sure this module calls this method upon initialization so that our filters get added upon startup (important for the production environment).</p>

<figure class='code'><figcaption><span>devise_filters.rb </span><a href='https://gist.github.com/1851733'>View Gist</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Put this somewhere it will get auto-loaded, like config/initializers</span>
</span><span class='line'><span class="k">module</span> <span class="nn">DeviseFilters</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">add_filters</span>
</span><span class='line'>    <span class="c1"># Example of adding a before_filter to all the Devise controller</span>
</span><span class='line'>    <span class="c1"># actions we care about.</span>
</span><span class='line'>    <span class="o">[</span>
</span><span class='line'>      <span class="no">Devise</span><span class="o">::</span><span class="no">SessionsController</span><span class="p">,</span>
</span><span class='line'>      <span class="no">Devise</span><span class="o">::</span><span class="no">RegistrationsController</span><span class="p">,</span>
</span><span class='line'>      <span class="no">Devise</span><span class="o">::</span><span class="no">PasswordsController</span>
</span><span class='line'>    <span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">controller</span><span class="o">|</span>
</span><span class='line'>      <span class="n">controller</span><span class="o">.</span><span class="n">before_filter</span> <span class="ss">:prepare_for_mobile</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Example of adding one selective before_filter.</span>
</span><span class='line'>    <span class="no">Devise</span><span class="o">::</span><span class="no">RegistrationsController</span><span class="o">.</span><span class="n">before_filter</span> <span class="ss">:check_invite_code</span><span class="p">,</span> <span class="ss">:only</span> <span class="o">=&gt;</span> <span class="ss">:new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">add_filters</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>At this point, we&#8217;re in the same place we left off back in August: we can add filters to Devise controller actions, but in development mode the second request reloads all the Devise classes and all our filters are gone.</p>

<p>To address this, we need to add a bit of code to the end of the initializer block in <code>config/environments/development.rb</code> like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">MyApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># ...the usual stuff ...</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Stuff to do on each request</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">to_prepare</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">DeviseFilters</span><span class="o">.</span><span class="n">add_filters</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This tells Rails to call your <code>DeviseFilters.add_filters</code> method before each new request in development mode, after the classes have been reloaded.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/16/enumerate-rails-3-controller-filters/">Enumerate Rails 3 Controller Filters</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-16T22:13:00-08:00" pubdate data-updated="true">Feb 16<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/02/16/enumerate-rails-3-controller-filters/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There may come a time that you wish to programatically get a list of what before_filters, after_filters, and around_filters are set on a given controller class in Rails. In Rails 2, there was a <code>filter_chain</code> method on <code>ActionController::Base</code> that you could use to do this. That method is gone in Rails 3 in favor of something much more magical.</p>

<p>One reason for wanting to do this is simply for debugging. Sometimes you just need to sanity check that filters are being applied in the order you think they are. Especially when they&#8217;re being added dynamically by various plugins.</p>

<p>In Rails 3, I find it convenient to add a few utility methods to <code>ApplicationController</code> that list out the symbol names of all the filters on any given controller:</p>

<figure class='code'><figcaption><span>application_controller.rb </span><a href='https://gist.github.com/1851142'>View Gist</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Add these methods to your ApplicationController. Then, any controller</span>
</span><span class='line'><span class="c1"># that inherits from it will have these methods and can programmatically</span>
</span><span class='line'><span class="c1"># determine what filters it has set.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">filters</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="n">all_filters</span> <span class="o">=</span> <span class="n">_process_action_callbacks</span>
</span><span class='line'>    <span class="n">all_filters</span> <span class="o">=</span> <span class="n">all_filters</span><span class="o">.</span><span class="n">select</span><span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">kind</span><span class="p">}</span> <span class="k">if</span> <span class="n">kind</span>
</span><span class='line'>    <span class="n">all_filters</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:filter</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">before_filters</span>
</span><span class='line'>    <span class="n">filters</span><span class="p">(</span><span class="ss">:before</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">after_filters</span>
</span><span class='line'>    <span class="n">filters</span><span class="p">(</span><span class="ss">:after</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">around_filters</span>
</span><span class='line'>    <span class="n">filters</span><span class="p">(</span><span class="ss">:around</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that in hand, you can do something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ree</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">7</span><span class="o">-</span><span class="mi">2011</span><span class="o">.</span><span class="mo">03</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="n">ap</span> <span class="no">PostsController</span><span class="o">.</span><span class="n">before_filters</span>
</span><span class='line'><span class="o">[</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="ss">:verify_authenticity_token</span><span class="p">,</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="s2">&quot;_callback_before_1&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="ss">:set_geokit_domain</span><span class="p">,</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="ss">:block_internet_explorer</span><span class="p">,</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="ss">:add_authenticity_token</span><span class="p">,</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="ss">:always_mobile</span><span class="p">,</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">6</span><span class="o">]</span> <span class="ss">:find_post</span><span class="p">,</span>
</span><span class='line'>    <span class="o">[</span><span class="mi">7</span><span class="o">]</span> <span class="ss">:set_meta_tags</span>
</span><span class='line'><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section class='aboutMe'>
  <h1>About Me</h1>
  <img class="left" src="/favicon.png" width="75" height="75">
  <p>Husband. Father. Techie. Founder and Principal Engineer at <a href="http://facetdigital.com/">Facet Digital, LLC</a>. Fitness and health enthusiast. Seattle Sounders FC fan. All opinions are mine alone. All trademarks are property of their respective owners.</p>
</section>
<section>
  <h1>Latest Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/24/defeating-the-infamous-chef-3694-warning/">Defeating The Infamous CHEF-3694 Warning</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/11/optimistic-locking-with-couchbase-and-ruby/">Optimistic Locking With Couchbase and Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/10/5-things-your-code-must-be/">5 Things Your Code Must Be</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/09/defeating-the-infamous-mechanize-too-many-connection-resets-bug/">Defeating The Infamous Mechanize &#8220;Too Many Connection Resets&#8221; Bug</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/08/easy-papertrail-deployment-using-rake/">Easy Papertrail Deployment Using Rake</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("scottwb69", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/scottwb69" class="twitter-follow-button" data-show-count="true">Follow @scottwb69</a>
  
</section>


<section>
  <h1>Latest Code</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/scottwb">@scottwb</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        var blacklist = [];
        
          
            blacklist.push('scottwb.github.com');
          
            blacklist.push('haml-block-bug');
          
        

        github.showRepos({
            user: 'scottwb',
            count: 5,
            skip_forks: true,
            blacklist: blacklist,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/106700002337561490782?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section class='shelfari'>
  <h1>Latest Books</h1>
  <div id="ShelfariWidget203753"><a href='http://www.shelfari.com/'>Shelfari: Book reviews on your book blog</a><script src="http://www.shelfari.com/ws/203753/widget.js?r=41860" type="text/javascript" language="javascript"></script></div>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Scott W. Bradley -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'scottwb';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
